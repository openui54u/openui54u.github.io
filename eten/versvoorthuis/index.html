<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Vers voor Thuis Filter Tool</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { text-align: center; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
th { background-color: #f5f5f5; }
.filter-section { display: flex; justify-content: space-between; flex-wrap: wrap; margin-bottom: 20px; }
.filter-group { margin: 5px; max-width: 45%; }
.filter-group label { display: block; }
</style>
</head>
<body>

<h1>Vers voor Thuis Filter Tool</h1>

<div class="filter-section">
    <div class="filter-group" id="category-filters">
        <h3>Categorieën</h3>
    </div>
    <div class="filter-group" id="exclude-ingredients">
        <h3>Ingrediënten uitsluiten</h3>
    </div>
</div>

<table id="meals-table">
    <thead>
        <tr>
            <th>Naam</th>
            <th>Categorieën</th>
            <th>Ingrediënten</th>
            <th>Link</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
// =============================
// CSV bestand lezen
// =============================
fetch('meals.csv')
.then(response => response.text())
.then(csvText => {
    const data = Papa.parse(csvText, {header: true, skipEmptyLines: true}).data;
    // const meals = data.map(row => ({
    //     name: row['name'],
    //     categories: row['categories'].split(';').map(s=>s.trim()),
    //     ingredients: row['ingredients'].split(';').map(s=>s.trim()),
    //     url: row['url']
    // }));
    const meals = data.map(row => ({
    name: row['name'],
    categories: row['categories'].split(';').map(s=>s.trim()),
    ingredients: row['ingredients'].split(';').map(s=>s.trim()),
    url: row['url']
}));
    initializeFilters(meals);
    displayMeals(meals);
});

// =============================
// Filters genereren
// =============================
function initializeFilters(meals) {
    const categorySet = new Set();
    const ingredientSet = new Set();
    meals.forEach(meal => {
        meal.categories.forEach(c => categorySet.add(c));
        meal.ingredients.forEach(i => ingredientSet.add(i));
    });

    const catContainer = document.getElementById('category-filters');
    categorySet.forEach(cat => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" value="${cat}" onchange="applyFilters()"> ${cat}`;
        catContainer.appendChild(label);
    });

    const ingContainer = document.getElementById('exclude-ingredients');
    ingredientSet.forEach(ing => {
        const label = document.createElement('label');
        label.innerHTML = `<input type="checkbox" value="${ing}" onchange="applyFilters()"> ${ing}`;
        ingContainer.appendChild(label);
    });

    window.allMeals = meals; // Globaal voor filtering
}

// =============================
// Filter functie
// =============================
function applyFilters() {
    const selectedCategories = Array.from(document.querySelectorAll("#category-filters input:checked")).map(i=>i.value);
    const excludedIngredients = Array.from(document.querySelectorAll("#exclude-ingredients input:checked")).map(i=>i.value);

    const filteredMeals = window.allMeals.filter(meal => {
        // Controleer categorieën
        const catMatch = selectedCategories.every(cat => meal.categories.includes(cat));
        // Controleer uitgesloten ingrediënten
        const ingMatch = !excludedIngredients.some(ing => meal.ingredients.includes(ing));
        return catMatch && ingMatch;
    });

    displayMeals(filteredMeals);
}

// =============================
// Tabel vullen
// =============================
function displayMeals(meals) {
    const tbody = document.querySelector("#meals-table tbody");
    tbody.innerHTML = "";
    meals.forEach(meal => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${meal.name}</td>
            <td>${meal.categories.join(', ')}</td>
            <td>${meal.ingredients.join(', ')}</td>
            <td><a href="${meal.url}" target="_blank">Link</a></td>
        `;
        tbody.appendChild(tr);
    });
}
</script>

</body>
</html>
