<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>VersvoorThuis Filter</title>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background: #fafafa;
    }
    h1 {
        margin-bottom: 10px;
    }
    .filter-box {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        box-shadow: 0 0 5px rgba(0,0,0,0.15);
    }
    .category-container {
        columns: 3;
        -webkit-columns: 3;
        -moz-columns: 3;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        box-shadow: 0 0 5px rgba(0,0,0,0.15);
    }
    th, td {
        padding: 8px;
        border-bottom: 1px solid #ccc;
    }
    th {
        background: #eee;
        text-align: left;
    }
    tr:hover {
        background: #f3f3f3;
    }
    .link a {
        color: #0066cc;
        text-decoration: none;
        font-weight: bold;
    }
</style>

</head>
<body>

<h1>Versvoorthuis Maaltijden Filter</h1>

<div class="filter-box">
    <h3>Categorieën</h3>
    <div id="category-box" class="category-container"></div>

    <h3>Ingrediënten uitsluiten (komma-gescheiden woorden):</h3>
    <input id="exclude-input" type="text" placeholder="bijv: melk, paprika, knoflook" style="width:100%; padding:8px;">

    <br><br>
    <button onclick="applyFilters()" style="padding:10px 20px;">Filter toepassen</button>
</div>

<table>
    <thead>
        <tr>
            <th>Categorie</th>
            <th>Ingrediënten</th>
            <th>Link</th>
        </tr>
    </thead>
    <tbody id="table-body"></tbody>
</table>

<script>
// ---- CSV Loader ----
async function loadCSV() {
    const response = await fetch("meals.csv");
    const text = await response.text();

    const rows = text.split("\n").slice(1); // skip header

    window.meals = rows
        .map(r => r.split(/,(.+)/))   // split first comma only (categorie, rest)
        .map((parts, index) => {
            if (!parts || parts.length < 2) return null;

            // parts[1] contains ingrediënten + link → split laatste komma
            const secondSplit = parts[1].split(/,(?=[^,]*$)/);

            return {
                Categorie: parts[0]?.trim() || "",
                Ingrediënten: secondSplit[0]?.trim() || "",
                Link: secondSplit[1]?.trim() || ""
            };
        })
        .filter(r => r && r.Categorie.length > 0);

    populateTable();
    buildCategoryFilters();
}

// ---- Tabel vullen ----
function populateTable() {
    const tbody = document.getElementById("table-body");
    tbody.innerHTML = "";

    window.meals.forEach(m => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td class="cat">${m.Categorie}</td>
            <td class="ing">${m.Ingrediënten}</td>
            <td class="link"><a href="${m.Link}" target="_blank">Bekijk</a></td>
        `;
        tbody.appendChild(tr);
    });
}

// ---- Categorie checkboxes ----
function buildCategoryFilters() {
    const categories = [...new Set(window.meals.map(m => m.Categorie))].sort();
    const box = document.getElementById("category-box");

    categories.forEach(cat => {
        const id = "cat_" + cat.replace(/\s+/g, "_");

        const div = document.createElement("div");
        div.innerHTML = `
            <label>
                <input type="checkbox" class="category-checkbox" value="${cat}">
                ${cat}
            </label>
        `;
        box.appendChild(div);
    });
}

// ---- Filters toepassen ----
function applyFilters() {
    const selectedCategories = Array.from(
        document.querySelectorAll('.category-checkbox:checked')
    ).map(cb => cb.value);

    let excludedWords = document.getElementById("exclude-input").value
        .toLowerCase()
        .split(",")
        .map(w => w.trim())
        .filter(w => w.length > 0);

    const rows = document.querySelectorAll("#table-body tr");

    rows.forEach(row => {
        const category = row.querySelector(".cat").textContent.trim();
        const ingred = row.querySelector(".ing").textContent.toLowerCase();

        let visible = true;

        // Categorie filter
        if (selectedCategories.length > 0 && !selectedCategories.includes(category)) {
            visible = false;
        }

        // Uitsluit woorden
        for (let word of excludedWords) {
            if (word.length > 0 && ingred.includes(word)) {
                visible = false;
                break;
            }
        }

        row.style.display = visible ? "" : "none";
    });
}

loadCSV();
</script>

</body>
</html>
